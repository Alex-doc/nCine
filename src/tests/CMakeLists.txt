cmake_minimum_required(VERSION 3.1)
project(nCine-srctests)

if(MSVC)
	add_custom_target(copy_dlls_srctests ALL
		COMMAND ${CMAKE_COMMAND} -E copy_directory ${BINDIR} ${CMAKE_BINARY_DIR}/src/tests
		COMMENT "Copying DLLs to src/tests..."
	)
	set_target_properties(copy_dlls_srctests PROPERTIES FOLDER "CustomCopyTargets")
endif()

if(Threads_FOUND)
	add_executable(apptest_threads apptest_threads.cpp)
	target_link_libraries(apptest_threads ncine_main ncine)
	target_include_directories(apptest_threads PRIVATE ../include)
	add_executable(apptest_threadpool apptest_threadpool.cpp)
	target_link_libraries(apptest_threadpool ncine_main ncine)
	target_include_directories(apptest_threadpool PRIVATE ../include)
	set_target_properties(apptest_threads apptest_threadpool PROPERTIES FOLDER "SrcTests")
	install(TARGETS apptest_threads apptest_threadpool RUNTIME DESTINATION ${RUNTIME_INSTALL_DESTINATION} COMPONENT tests)
endif()

add_executable(glapptest_fbo_cube glapptest_fbo_cube.cpp)
target_link_libraries(glapptest_fbo_cube ncine_main ncine)
target_include_directories(glapptest_fbo_cube PRIVATE ../include)
set_target_properties(glapptest_fbo_cube PROPERTIES FOLDER "SrcTests")
install(TARGETS glapptest_fbo_cube RUNTIME DESTINATION ${RUNTIME_INSTALL_DESTINATION} COMPONENT tests)
if(NCINE_EMBED_SHADERS)
	target_compile_definitions(glapptest_fbo_cube PRIVATE "WITH_EMBEDDED_SHADERS")
	target_include_directories(glapptest_fbo_cube PRIVATE ${GENERATED_INCLUDE_DIR})
endif()
if(WIN32)
	target_compile_definitions(glapptest_fbo_cube PRIVATE "WITH_GLEW")
	if(MSVC)
		target_include_directories(glapptest_fbo_cube PRIVATE "${EXTERNAL_MSVC_DIR}/include")
	endif()
endif()
