#include "ncThreadSync.h"
#include "ncServiceLocator.h"

///////////////////////////////////////////////////////////
// ncMutex CLASS
///////////////////////////////////////////////////////////

///////////////////////////////////////////////////////////
// CONSTRUCTORS and DESTRUCTOR
///////////////////////////////////////////////////////////

ncMutex::ncMutex()
{
	pthread_mutex_init(&m_mutex, NULL);
}

ncMutex::~ncMutex()
{
	pthread_mutex_destroy(&m_mutex);
}

///////////////////////////////////////////////////////////
// PUBLIC FUNCTIONS
///////////////////////////////////////////////////////////

void ncMutex::Lock()
{
	pthread_mutex_lock(&m_mutex);
}

void ncMutex::Unlock()
{
	pthread_mutex_unlock(&m_mutex);
}

int ncMutex::TryLock()
{
	return pthread_mutex_trylock(&m_mutex);
}


///////////////////////////////////////////////////////////
// ncCondVariable CLASS
///////////////////////////////////////////////////////////

///////////////////////////////////////////////////////////
// CONSTRUCTORS and DESTRUCTOR
///////////////////////////////////////////////////////////

ncCondVariable::ncCondVariable()
{
	pthread_cond_init(&m_cond, NULL);
}

ncCondVariable::~ncCondVariable()
{
	pthread_cond_destroy(&m_cond);
}

///////////////////////////////////////////////////////////
// PUBLIC FUNCTIONS
///////////////////////////////////////////////////////////

void ncCondVariable::Wait(ncMutex &rMutex)
{
	pthread_cond_wait(&m_cond, &(rMutex.m_mutex));
}

void ncCondVariable::Signal()
{
	pthread_cond_signal(&m_cond);
}

void ncCondVariable::Broadcast()
{
	pthread_cond_broadcast(&m_cond);
}


///////////////////////////////////////////////////////////
// ncRWLock CLASS
///////////////////////////////////////////////////////////

///////////////////////////////////////////////////////////
// CONSTRUCTORS and DESTRUCTOR
///////////////////////////////////////////////////////////


#if !defined(_WIN32) && !defined(__WIN32__) && !defined(__WINDOWS__)

ncRWLock::ncRWLock()
{
	pthread_rwlock_init(&m_rwlock, NULL);
}

ncRWLock::~ncRWLock()
{
	pthread_rwlock_destroy(&m_rwlock);
}

#endif

///////////////////////////////////////////////////////////
// ncBarrier CLASS
///////////////////////////////////////////////////////////

///////////////////////////////////////////////////////////
// CONSTRUCTORS and DESTRUCTOR
///////////////////////////////////////////////////////////

#if !defined (__ANDROID__) && !defined(__APPLE__)

/// Creates a barrier for the specified amount of waiting threads
ncBarrier::ncBarrier(unsigned int uCount)
{
	pthread_barrier_init(&m_barrier, NULL, uCount);
}

ncBarrier::~ncBarrier()
{
	pthread_barrier_destroy(&m_barrier);
}

#endif
