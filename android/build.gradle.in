import org.apache.tools.ant.taskdefs.condition.Os

buildscript {
	repositories {
		jcenter()
	}
	dependencies {
		classpath 'com.android.tools.build:gradle:2.3.+'
	}
}

apply plugin: 'com.android.application'

android {

	def numCores = Runtime.runtime.availableProcessors()

	def ndkCommand = null
	if (Os.isFamily(Os.FAMILY_WINDOWS)) {
		ndkCommand = 'ndk-build.cmd'
	} else {
		ndkCommand = 'ndk-build'
	}

    buildToolsVersion "@NCINE_BUILDTOOLS_VERSION@"
	compileSdkVersion @NCINE_COMPILESDK_VERSION@

	defaultConfig {
		minSdkVersion @NCINE_MINSDK_VERSION@
		targetSdkVersion @NCINE_TARGETSDK_VERSION@
		versionCode @NCINE_VERSIONCODE@
		versionName "@NCINE_VERSION@"
	}

	sourceSets.main {
		jniLibs.srcDir 'src/main/libs'
		jni.srcDirs = [] // disable automatic ndk-build call
	}

	task ndkBuild(type: Exec) {
		commandLine ndkCommand, '-C', file('src/main').absolutePath, '-j' + numCores
	}

	tasks.withType(JavaCompile) {
		compileTask -> compileTask.dependsOn ndkBuild
	}

	task ndkClean(type: Exec) {
		commandLine ndkCommand, '-C', file('src/main').absolutePath, 'clean'
	}

	clean.dependsOn 'ndkClean'
}
